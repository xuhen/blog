<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="This is the blog page of Edward">
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        React 应用中的优化技巧 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="https://dn-coding-net-production-static.qbox.me/static/7a51352fa766f4176d7c4543339e0e98.png" />
        </div>
        <div class="name">
            <i>Edward xu</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-使用纯组件"><span class="toc-text">1. 使用纯组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-使用-React-memo-进行组件记忆"><span class="toc-text">2. 使用 React.memo 进行组件记忆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-使用-shouldComponentUpdate-生命周期事件"><span class="toc-text">3. 使用 shouldComponentUpdate 生命周期事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-懒加载组件"><span class="toc-text">4. 懒加载组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-使用-React-Fragments-避免额外标记"><span class="toc-text">5. 使用 React Fragments 避免额外标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-不要使用内联函数定义"><span class="toc-text">6. 不要使用内联函数定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-避免-componentWillMount-中的异步请求"><span class="toc-text">7. 避免 componentWillMount() 中的异步请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-箭头函数与构造函数中的绑定"><span class="toc-text">8. 箭头函数与构造函数中的绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-避免使用内联样式属性"><span class="toc-text">9.避免使用内联样式属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-优化-React-中的条件渲染"><span class="toc-text">10.优化 React 中的条件渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-为组件创建错误边界"><span class="toc-text">11.为组件创建错误边界</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下面部分为React里的一些技术细节"><span class="toc-text">下面部分为React里的一些技术细节</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        React 应用中的优化技巧
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2019-12-23 19:22:59</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#react" title="react">react</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <p>本文提供一些减少 React 重绘的小技巧</p>
<h2 id="1-使用纯组件"><a href="#1-使用纯组件" class="headerlink" title="1. 使用纯组件"></a>1. 使用纯组件</h2><p>它与普通组件（Component）是一样的，只是 PureComponents 负责 shouldComponentUpdate——它对状态和 props 数据进行浅层比较（shallow comparison）。如果先前的状态( state )和 props 数据与下一个 props 或状态相同，则组件不会重新渲染。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">export default class ApplicationComponent extends React.Component &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        super();</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            name: &quot;Mayank&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    updateState = () =&gt; &#123;</span><br><span class="line">        setInterval(() =&gt; &#123;</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                name: &quot;Mayank&quot;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        this.updateState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line"></span><br><span class="line">        console.log(&quot;Render Called Again&quot;)</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;PureChildComponent name=&#123;this.state.name&#125; /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PureChildComponent extends React.PureComponent &#123;</span><br><span class="line"></span><br><span class="line">    // Pure Components are the components that do not re-render if the State data or props data is still the same</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        console.log(&quot;Pure Component Rendered..&quot;)</span><br><span class="line">        return &lt;div&gt;&#123;this.props.name&#125;&lt;/div&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-使用-React-memo-进行组件记忆"><a href="#2-使用-React-memo-进行组件记忆" class="headerlink" title="2. 使用 React.memo 进行组件记忆"></a>2. 使用 React.memo 进行组件记忆</h2><p>它很像 PureComponent，但 PureComponent 属于 Component 的类实现，而“memo”则用于创建函数组件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function CustomisedComponen(props) &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;b&gt;User name: &#123;props.user.name&#125;&lt;/b&gt;</span><br><span class="line">            &lt;b&gt;User age: &#123;props.user.age&#125;&lt;/b&gt;</span><br><span class="line">            &lt;b&gt;User designation: &#123;props.user.designation&#125;&lt;/b&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function userComparator(previosProps, nextProps) &#123;</span><br><span class="line">    if(previosProps.user.name !== nextProps.user.name ||</span><br><span class="line">       previosProps.user.age !== nextProps.user.age ||</span><br><span class="line">       previosProps.user.designation !== nextProps.user.designation) &#123;</span><br><span class="line">        return false</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var memoComponent = React.memo(CustomisedComponent, userComparator);</span><br></pre></td></tr></table></figure>
<p>假设 props 值（user）是一个对象引用，包含特定用户的 name、age 和 designation。这种情况下需要进行深入比较。我们可以创建一个自定义函数，查找前后两个 props 值的 name、age 和 designation 的值，如果它们不相同则返回 false。</p>
<h2 id="3-使用-shouldComponentUpdate-生命周期事件"><a href="#3-使用-shouldComponentUpdate-生命周期事件" class="headerlink" title="3. 使用 shouldComponentUpdate 生命周期事件"></a>3. 使用 shouldComponentUpdate 生命周期事件</h2><p>可以利用此事件来决定何时需要重新渲染组件。如果组件 props 更改或调用 setState，则此函数返回一个 Boolean 值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">export default class ShouldComponentUpdateUsage extends React.Component &#123;</span><br><span class="line"></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      name: &quot;Mayank&quot;;</span><br><span class="line">      age: 30,</span><br><span class="line">      designation: &quot;Architect&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      this.setState(&#123;</span><br><span class="line">        designation: &quot;Senior Architect&quot;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">      if(nextState.age != this.state.age || netState.name = this.state.name) &#123;</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;b&gt;User Name:&lt;/b&gt; &#123;this.state.name&#125;</span><br><span class="line">        &lt;b&gt;User Age:&lt;/b&gt; &#123;this.state.age&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-懒加载组件"><a href="#4-懒加载组件" class="headerlink" title="4. 懒加载组件"></a>4. 懒加载组件</h2><p>像 webpack 这样的打包器就支持代码拆分，它可以为应用创建多个包，并在运行时动态加载，减少初始包的大小。为此我们使用 Suspense 和 lazy。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; lazy, Suspense &#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">export default class CallingLazyComponents extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line"></span><br><span class="line">    var ComponentToLazyLoad = null;</span><br><span class="line"></span><br><span class="line">    if(this.props.name == &quot;Mayank&quot;) &#123;</span><br><span class="line">      ComponentToLazyLoad = lazy(() =&gt; import(&quot;./mayankComponent&quot;));</span><br><span class="line">    &#125; else if(this.props.name == &quot;Anshul&quot;) &#123;</span><br><span class="line">      ComponentToLazyLoad = lazy(() =&gt; import(&quot;./anshulComponent&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;This is the Base User: &#123;this.state.name&#125;&lt;/h1&gt;</span><br><span class="line">            &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;/div&gt;&#125;&gt;</span><br><span class="line">                &lt;ComponentToLazyLoad /&gt;</span><br><span class="line">            &lt;/Suspense&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个方法的好处:</p>
<ol>
<li>主包体积变小，消耗的网络传输时间更少。</li>
<li>动态单独加载的包比较小，可以迅速加载完成。</li>
</ol>
</blockquote>
<h2 id="5-使用-React-Fragments-避免额外标记"><a href="#5-使用-React-Fragments-避免额外标记" class="headerlink" title="5. 使用 React Fragments 避免额外标记"></a>5. 使用 React Fragments 避免额外标记</h2><p>片段不会向组件引入任何额外标记，但它仍然为两个相邻标记提供父级，因此满足在组件顶级具有单个父级的条件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export default class NestedRoutingComponent extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Fragment&gt;</span><br><span class="line">                &lt;h1&gt;This is the Header Component&lt;/h1&gt;</span><br><span class="line">                &lt;h2&gt;Welcome To Demo Page&lt;/h2&gt;</span><br><span class="line">            &lt;/Fragment&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-不要使用内联函数定义"><a href="#6-不要使用内联函数定义" class="headerlink" title="6. 不要使用内联函数定义"></a>6. 不要使用内联函数定义</h2><p>如果我们使用内联函数，则每次调用“render”函数时都会创建一个新的函数实例。<br>当 React 进行虚拟 DOM diffing 时，它每次都会找到一个新的函数实例；因此在渲染阶段它会会绑定新函数并将旧实例扔给垃圾回收。<br>因此直接绑定内联函数就需要额外做垃圾回收和绑定到 DOM 的新函数的工作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export default class InlineFunctionComponent extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Welcome Guest&lt;/h1&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; onClick=&#123;(e) =&gt; &#123; this.setState(&#123;inputValue: e.target.value&#125;) &#125;&#125; value=&quot;Click For Inline Function&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以不要用内联函数，而是在组件内部创建一个函数，并将事件绑定到该函数本身。这样每次调用 render 时就不会创建单独的函数实例了，参考组件如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">export default class InlineFunctionComponent extends React.Component &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.state = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    this.setNewStateData = this.setNewStateData.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setNewStateData (event) &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      inputValue: e.target.value</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Welcome Guest&lt;/h1&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; onClick=&#123;this.setNewStateData&#125; value=&quot;Click For Inline Function&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-避免-componentWillMount-中的异步请求"><a href="#7-避免-componentWillMount-中的异步请求" class="headerlink" title="7. 避免 componentWillMount() 中的异步请求"></a>7. 避免 componentWillMount() 中的异步请求</h2><p>这个函数用的不多，可用来配置组件的初始配置，但使用 constructor 方法也能做到。<br>一些开发人员认为这个函数可以用来做异步数据 API 调用, 但是也可以在componentDidMount 去做，其性能没有多大差别，所以即将在v17.0中被弃用</p>
<h2 id="8-箭头函数与构造函数中的绑定"><a href="#8-箭头函数与构造函数中的绑定" class="headerlink" title="8. 箭头函数与构造函数中的绑定"></a>8. 箭头函数与构造函数中的绑定</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export default class DelayedBinding extends React.Component &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      name: &quot;Mayank&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleButtonClick = () =&gt; &#123;</span><br><span class="line">    alert(&quot;Button Clicked: &quot; + this.state.name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;Click&quot; onClick=&#123;this.handleButtonClick&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们添加箭头函数时，该函数被添加为对象实例，而不是类的原型属性。这意味着如果我们多次复用组件，那么在组件外创建的每个对象中都会有这些函数的多个实例。<br>因此箭头函数确实有其缺点。实现这些函数的最佳方法是在构造函数中绑定函数。</p>
<h2 id="9-避免使用内联样式属性"><a href="#9-避免使用内联样式属性" class="headerlink" title="9.避免使用内联样式属性"></a>9.避免使用内联样式属性</h2><p>使用内联样式时浏览器需要花费更多时间来处理脚本和渲染，因为它必须映射传递给实际 CSS 属性的所有样式规则。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export default class InlineStyledComponents extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &lt;b style=&#123;&#123;&quot;backgroundColor&quot;: &quot;blue&quot;&#125;&#125;&gt;Welcome to Sample Page&lt;/b&gt;</span><br><span class="line">      &lt;/&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面样式 backgroundColor 需要转换为等效的 CSS 样式属性，然后才应用样式。这样就需要额外的脚本处理和 JS 执行工作。更好的办法是将 CSS 文件导入组件。</p>
<h2 id="10-优化-React-中的条件渲染"><a href="#10-优化-React-中的条件渲染" class="headerlink" title="10.优化 React 中的条件渲染"></a>10.优化 React 中的条件渲染</h2><p>安装和卸载 React 组件是昂贵的操作。为了提升性能，我们需要减少安装和卸载的操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">export default class ConditionalRendering extends React.Component &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      name: &quot;Mayank&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    if(this.state.name == &quot;Mayank&quot;) &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">          &lt;AdminHeaderComponent&gt;&lt;/AdminHeaderComponent&gt;</span><br><span class="line">          &lt;HeaderComponent&gt;&lt;/HeaderComponent&gt;</span><br><span class="line">          &lt;ContentComponent&gt;&lt;/ContentComponent&gt;</span><br><span class="line">        &lt;/&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">          &lt;HeaderComponent&gt;&lt;/HeaderComponent&gt;</span><br><span class="line">          &lt;ContentComponent&gt;&lt;/ContentComponent&gt;</span><br><span class="line">        &lt;/&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码可以优化为下面代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export default class ConditionalRendering extends React.Component &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      name: &quot;Mayank&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &#123; this.state.name == &quot;Mayank&quot; &amp;&amp; &lt;AdminHeaderComponent&gt;&lt;/AdminHeaderComponent&gt; &#125;</span><br><span class="line">        &lt;HeaderComponent&gt;&lt;/HeaderComponent&gt;</span><br><span class="line">        &lt;ContentComponent&gt;&lt;/ContentComponent&gt;</span><br><span class="line">      &lt;/&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，当 name 不是 Mayank 时，React 在位置 1 处放置 null。</p>
<p>开始 DOM diffing 时，位置 1 的元素从 AdminHeaderComponent 变为 null，但位置 2 和位置 3 的组件保持不变。</p>
<p>由于元素没变，因此组件不会卸载，减少了不必要的操作。</p>
<h2 id="11-为组件创建错误边界"><a href="#11-为组件创建错误边界" class="headerlink" title="11.为组件创建错误边界"></a>11.为组件创建错误边界</h2><p>组件渲染错误是很常见的情况。<br>在这种情况下，组件错误不应该破坏整个应用。创建错误边界可避免应用在特定组件发生错误时中断。<br>错误边界是一个 React 组件，可以捕获子组件中的 JavaScript 错误。我们可以包含错误、记录错误消息，并为 UI 组件故障提供回退机制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">class Home extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    console.log(&apos;componentDidMount&apos;);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;ErrorBoundary&gt;</span><br><span class="line">          &lt;MyWidget /&gt;</span><br><span class="line">        &lt;/ErrorBoundary&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ErrorBoundary extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123; hasError: false &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static getDerivedStateFromError(error) &#123;</span><br><span class="line">    console.log(&apos;getDerivedStateFromError&apos;, error);</span><br><span class="line">    return &#123; hasError: true &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidCatch(error, errorInfo) &#123;</span><br><span class="line">    // You can also log the error to an error reporting service</span><br><span class="line">    console.log(&apos;componentDidCatch&apos;, error, errorInfo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    if (this.state.hasError) &#123;</span><br><span class="line">      // You can render any custom fallback UI</span><br><span class="line">      return &lt;h1&gt;Something went wrong.&lt;/h1&gt;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return this.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyWidget extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line"></span><br><span class="line">    this.state = &#123;</span><br><span class="line">      name: &apos;tom&apos;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.state.name&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &#123;this.state.hello.map((item, idx) =&gt; &#123;</span><br><span class="line">            return &lt;div key=&#123;idx&#125;&gt;&lt;/div&gt;</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上state上没有hello，故MyWidget内会报错，会被ErrorBoundary捕获并提供回退 UI。</p>
<h2 id="下面部分为React里的一些技术细节"><a href="#下面部分为React里的一些技术细节" class="headerlink" title="下面部分为React里的一些技术细节"></a>下面部分为React里的一些技术细节</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Q. React 如何区分Class组件和Function组件?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A.</span><br><span class="line">// Inside React</span><br><span class="line">class Component &#123;&#125;</span><br><span class="line">Component.prototype.isReactComponent = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">// We can check it like this</span><br><span class="line">class Greeting extends Component &#123;&#125;</span><br><span class="line">console.log(Greeting.prototype.isReactComponent); // ✅ Yes</span><br><span class="line"></span><br><span class="line">Q. 为啥React Elements会有$$typeof属性？</span><br><span class="line"></span><br><span class="line">A.</span><br><span class="line">主要是服务端的安全问题，如果服务端有个漏洞，让用户存任意的JSON对象，而客户端期望的是个string类型变量，就会有问题</span><br><span class="line"></span><br><span class="line">let expectedTextButGotJSON = &#123;</span><br><span class="line">  type: &apos;div&apos;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    dangerouslySetInnerHTML: &#123;</span><br><span class="line">      __html: &apos;/* put your exploit here */&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;;</span><br><span class="line">let message = &#123; text: expectedTextButGotJSON &#125;;</span><br><span class="line"></span><br><span class="line">// Dangerous in React 0.13</span><br><span class="line">&lt;p&gt;</span><br><span class="line">  &#123;message.text&#125;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">如果加上$$typeof后变成</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  type: &apos;marquee&apos;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    bgcolor: &apos;#ffa7c4&apos;,</span><br><span class="line">    children: &apos;hi&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  key: null,</span><br><span class="line">  ref: null,</span><br><span class="line">  $$typeof: Symbol.for(&apos;react.element&apos;),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">原理是我们不能把Symbol 类型的数据放到自己定义的JSON上，因此即使服务器有安全漏洞返回JSON，</span><br><span class="line">React也会检查返回的对象上的$$typeof属性，如果缺失就不会解析，并抛错。</span><br></pre></td></tr></table></figure>
        
        <div id="comment-container">
        </div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = ""
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</html>
